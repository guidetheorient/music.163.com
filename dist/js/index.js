"use strict";$(function(){$.get("/src/recommendList.json").then(function(n){var e=n,a=$(".recommend-playlists"),t=$("<ul></ul>");e.map(function(n,e){$li="\n        <li data-rId="+n.rId+'>\n          <span class="view-time">\n            <svg class="icon headphone" aria-hidden="true">\n                <use xlink:href="#icon-headphone"></use>\n            </svg>\n            <span class="views">'+n.rPlayTimes+'</span>\n          </span>\n          <img src="'+n.rCoverUrl+'" alt="">\n          <p class="playlists-info">'+n.rTitle+"</p>\n        </li>\n      ",t.append($li)}),a.append(t),a.find("ul").on("click","li",function(n){var e=$(n.currentTarget).attr("data-rId");window.location.href="./playlist.html?rid="+e})}),$.get("//owf5g9dnv.bkt.clouddn.com/songsDB.json?v=20170922",function(n){var e=n,a=$(".latest-music"),t=$("<ol></ol>");e.forEach(function(n,e){$li=$('\n        <li>\n          <div class="song">\n            <h3 class="song-name">'+n.songName+'</h3>\n            <p class="song-info">  \n              '+n.songAuthor+" - "+n.album+'\n            </p>\n          </div>\n          <a class="play-btn" href="#">\n              <svg class="icon" aria-hidden="true">\n                <use xlink:href="#icon-play"></use>\n              </svg>\n          </a>\n        </li>\n      '),!0===n.sq&&$li.find(".song-info").prepend($('\n          <svg class="icon sq" aria-hidden="true">\n            <use xlink:href="#icon-sq"></use>\n          </svg>\n        ')),t.append($li)}),a.append(t).find(".loading").remove(),t.on("click","li",function(){var n=$(this).index();window.location.href="./play.html?id="+n})}),$(".index-nav").on("click",".tab-header>li",function(n){var e=$(n.currentTarget),a=e.index();e.addClass("active").siblings().removeClass("active"),e.trigger("tabSwitch",a),$(".tab-content > li").eq(a).addClass("active").siblings().removeClass("active")}),$(".index-nav").on("tabSwitch",function(n,e){var t=$(".tab-content>li").eq(e);if("yes"!==t.attr("data-isLoaded"))if(1===e)$.get("./src/hotlist.json").then(function(n){function e(n){var e=n+1;return Number(e)>0&&Number(e)<10?"0"+e:""+e}var a=n,i=$("<ol></ol>"),s=$(".hot-list-tab"),o=$(".hot-top .update-date");a.forEach(function(n,a){$li=$('\n            <li>\n              <h3 class="order-number">'+e(a)+'</h3>\n              <div class="song">\n                <h3 class="song-name">'+n.songName+'</h3>\n                <p class="song-info">  \n                  '+n.songAuthor+" - "+n.album+'\n                </p>\n                <a class="play-btn" href="#">\n                    <svg class="icon" aria-hidden="true">\n                      <use xlink:href="#icon-play"></use>\n                    </svg>\n                </a>\n              </div>\n            </li>\n          '),!0===n.sq&&$li.find(".song-info").prepend($('\n              <svg class="icon sq" aria-hidden="true">\n                <use xlink:href="#icon-sq"></use>\n              </svg>\n            ')),i.append($li)}),s.append(i).find(".loading").remove(),i.on("click","li",function(){var n=$(this).index();window.location.href="./play.html?id="+n}),t.attr("data-isLoaded","yes");var r=new Date,c=r.getMonth()+1,l=r.getDate();c<10&&(c="0"+c);var d=c+"月"+l+"日";o.text("更新日期："+d)});else if(2===e){var i=function(n){var e=/^\[(.*)\]$/;null!==localStorage.getItem("searchHistory")&&e.test(localStorage.getItem("searchHistory"))||localStorage.setItem("searchHistory","[]");var a=localStorage.getItem("searchHistory").match(/^\[[\,]*(.*)\]$/)[1].split(",");""!==n&&void 0!==n&&-1===a.indexOf(n)&&(a.push(n),localStorage.setItem("searchHistory","["+a.toString()+"]")),console.log(localStorage.getItem("searchHistory"),2);var t=$("<ul></ul>");a.length<1||(a.map(function(n){if(""!==n){var e='\n            <li class="item">\n              <svg class="icon history-icon" aria-hidden="true">\n                <use xlink:href="#icon-history"></use>\n              </svg>\n              <div class="history">\n                  <span>'+n+'</span>\n                  <svg class="icon close-icon" aria-hidden="true">\n                    <use xlink:href="#icon-close"></use>\n                  </svg>\n              </div>\n            </li>\n          ';t.append(e)}}),u.html(t),u.find(".close-icon").on("click",function(n){n.stopPropagation();var a=localStorage.getItem("searchHistory").match(e)[1].split(","),t=$(n.currentTarget).siblings("span").text(),i=a.indexOf(t);$(n.currentTarget).parents(".item").remove(),-1!==i&&a.splice(i,1),localStorage.setItem("searchHistory","["+a+"]")}),u.find("ul").on("click","li",function(n){var e=$(n.currentTarget).text().trim();$.get("/src/search.json").then(function(n){n.map(function(n){n.songName!==e||(window.location.href="./play.html?id="+n.id)})})}))},s=function(n){var e=$("<ul></ul>");n.map(function(n,a){var t=$('\n            <li class="item" data-index= '+n.id+'>\n              <svg class="icon search-icon" aria-hidden="true">\n                <use xlink:href="#icon-search"></use>\n              </svg>\n              <span>'+n.songName+"</span>\n            </li>\n          ");e.append(t)}),h.append(e),$(".sync-search>ul").on("click","li",function(n){a=$(n.currentTarget).text();var e=$(n.currentTarget).text().trim();i(e),location.href="./play.html?id="+$(n.currentTarget).attr("data-index")})},o=function(n){return new Promise(function(e,a){$.get("./src/search.json").then(function(a){var t=a.filter(function(e,a){for(key in e)if("id"!==key&&-1!==e[key].toString().toLowerCase().indexOf(n.toLowerCase()))return!0});e(t)})})},r=$(".search input"),c=void 0,l=$(".search .x-icon"),d=$(".hot-search"),u=$(".search-history"),h=$(".sync-search");$(".search-what");l.on("click",function(){r.val(""),h.text(""),d.add(u).addClass("active")}),r.on("input",function(n){var e=n.target.value.trim();if(""===e)return l.add(h).removeClass("active"),void d.add(u).addClass("active");l.addClass("active"),d.add(u).removeClass("active"),$h4=$('<h4 class="search-what"></h4>').text("搜索“"+e+"”"),h.html($h4).addClass("active"),clearTimeout(c),c=setTimeout(function(){o(e).then(function(n){s(n)})},1e3)}),$(".search form").keypress(function(n){if(13==n.keyCode){var e=r.val();n.preventDefault(),i(e)}}),function(){var n=void 0,e=[];$.get("//owf5g9dnv.bkt.clouddn.com/songsDB.json?v=20170922",function(a){for(n=a;e.length<6;){var t=Math.floor(10*Math.random());-1===e.indexOf(t)&&e.push(t)}var s=$("<ul></ul>");e.map(function(e){n.map(function(n){if(n.id===e){var a=$('\n                <li class="item"><a href="./play.html?id='+n.id+'">'+n.songName+"</a></li>               \n                ");s.append(a)}})}),s.on("click","li",function(n){var e=$(n.currentTarget).text().trim();i(e)}),d.append(s)})}(),i(),t.attr("data-isLoaded","yes")}})});