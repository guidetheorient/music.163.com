"use strict";$(function(){$.get("//owf5g9dnv.bkt.clouddn.com/recommendList.json").then(function(n){var a=n,e=$(".recommend-playlists"),t=$("<ul></ul>");a.map(function(n){var a="\n        <li data-rId="+n.rId+'>\n          <span class="view-time">\n            <svg class="icon headphone" aria-hidden="true">\n                <use xlink:href="#icon-headphone"></use>\n            </svg>\n            <span class="views">'+n.rPlayTimes+'</span>\n          </span>\n          <img src="'+n.rCoverUrl+'" alt="">\n          <p class="playlists-info">'+n.rTitle+"</p>\n        </li>\n      ";t.append(a)}),e.append(t),e.find("ul").on("click","li",function(n){var a=$(n.currentTarget).attr("data-rId");window.location.href="./playlist.html?rid="+a})}),$.get("//owf5g9dnv.bkt.clouddn.com/songsDB.json?v=20170922",function(n){var a=n,e=$(".latest-music"),t=$("<ol></ol>");a.forEach(function(n){var a=$('\n        <li>\n          <div class="song">\n            <h3 class="song-name">'+n.songName+'</h3>\n            <p class="song-info">  \n              '+n.songAuthor+" - "+n.album+'\n            </p>\n          </div>\n          <a class="play-btn" href="#">\n              <svg class="icon" aria-hidden="true">\n                <use xlink:href="#icon-play"></use>\n              </svg>\n          </a>\n        </li>\n      ');!0===n.sq&&a.find(".song-info").prepend($('\n          <svg class="icon sq" aria-hidden="true">\n            <use xlink:href="#icon-sq"></use>\n          </svg>\n        ')),t.append(a)}),e.append(t).find(".loading").remove(),t.on("click","li",function(){var n=$(this).index();window.location.href="./play.html?id="+n})}),$(".index-nav").on("click",".tab-header>li",function(n){var a=$(n.currentTarget),e=a.index();a.addClass("active").siblings().removeClass("active"),a.trigger("tabSwitch",e),$(".tab-content > li").eq(e).addClass("active").siblings().removeClass("active")}),$(".index-nav").on("tabSwitch",function(n,a){var e=$(".tab-content>li").eq(a);if("yes"!==e.attr("data-isLoaded"))if(1===a)$.get("//owf5g9dnv.bkt.clouddn.com/hotlist.json").then(function(n){function a(n){var a=n+1;return Number(a)>0&&Number(a)<10?"0"+a:""+a}var t=n,i=$("<ol></ol>"),s=$(".hot-list-tab"),o=$(".hot-top .update-date");t.forEach(function(n,e){var t=$('\n            <li>\n              <h3 class="order-number">'+a(e)+'</h3>\n              <div class="song">\n                <h3 class="song-name">'+n.songName+'</h3>\n                <p class="song-info">  \n                  '+n.songAuthor+" - "+n.album+'\n                </p>\n                <a class="play-btn" href="#">\n                    <svg class="icon" aria-hidden="true">\n                      <use xlink:href="#icon-play"></use>\n                    </svg>\n                </a>\n              </div>\n            </li>\n          ');!0===n.sq&&t.find(".song-info").prepend($('\n              <svg class="icon sq" aria-hidden="true">\n                <use xlink:href="#icon-sq"></use>\n              </svg>\n            ')),i.append(t)}),s.append(i).find(".loading").remove(),i.on("click","li",function(){var n=$(this).index();window.location.href="./play.html?id="+n}),e.attr("data-isLoaded","yes");var r=new Date,c=r.getMonth()+1,l=r.getDate();c<10&&(c="0"+c);var d=c+"月"+l+"日";o.text("更新日期："+d)});else if(2===a){var t=function(n){var a=/^\[(.*)\]$/;null!==localStorage.getItem("searchHistory")&&a.test(localStorage.getItem("searchHistory"))||localStorage.setItem("searchHistory","[]");var e=localStorage.getItem("searchHistory").match(/^\[[\,]*(.*)\]$/)[1].split(",");""!==n&&void 0!==n&&-1===e.indexOf(n)&&(e.push(n),localStorage.setItem("searchHistory","["+e.toString()+"]"));var t=$("<ul></ul>");e.length<1||(e.map(function(n){if(""!==n){var a='\n            <li class="item">\n              <svg class="icon history-icon" aria-hidden="true">\n                <use xlink:href="#icon-history"></use>\n              </svg>\n              <div class="history">\n                  <span>'+n+'</span>\n                  <svg class="icon close-icon" aria-hidden="true">\n                    <use xlink:href="#icon-close"></use>\n                  </svg>\n              </div>\n            </li>\n          ';t.append(a)}}),d.html(t),d.find(".close-icon").on("click",function(n){n.stopPropagation();var e=localStorage.getItem("searchHistory").match(a)[1].split(","),t=$(n.currentTarget).siblings("span").text(),i=e.indexOf(t);$(n.currentTarget).parents(".item").remove(),-1!==i&&e.splice(i,1),localStorage.setItem("searchHistory","["+e+"]")}),d.find("ul").on("click","li",function(n){var a=$(n.currentTarget).text().trim();$.get("//owf5g9dnv.bkt.clouddn.com/search.json").then(function(n){n.map(function(n){n.songName!==a||(window.location.href="./play.html?id="+n.id)})})}))},i=function(n){var a=$("<ul></ul>");n.map(function(n){var e=$('\n            <li class="item" data-index= '+n.id+'>\n              <svg class="icon search-icon" aria-hidden="true">\n                <use xlink:href="#icon-search"></use>\n              </svg>\n              <span>'+n.songName+"</span>\n            </li>\n          ");a.append(e)}),u.append(a),$(".sync-search>ul").on("click","li",function(n){var a=$(n.currentTarget).text().trim();t(a),location.href="./play.html?id="+$(n.currentTarget).attr("data-index")})},s=function(n){return new Promise(function(a){$.get("//owf5g9dnv.bkt.clouddn.com/search.json").then(function(e){var t=e.filter(function(a){for(var e in a)if("id"!==e&&-1!==a[e].toString().toLowerCase().indexOf(n.toLowerCase()))return!0});a(t)})})},o=$(".search input"),r=void 0,c=$(".search .x-icon"),l=$(".hot-search"),d=$(".search-history"),u=$(".sync-search");c.on("click",function(){o.val(""),u.text(""),l.add(d).addClass("active")}),o.on("input",function(n){var a=n.target.value.trim();if(""===a)return c.add(u).removeClass("active"),void l.add(d).addClass("active");c.addClass("active"),l.add(d).removeClass("active");var e=$('<h4 class="search-what"></h4>').text("搜索“"+a+"”");u.html(e).addClass("active"),clearTimeout(r),r=setTimeout(function(){s(a).then(function(n){i(n)})},300)}),$(".search form").keypress(function(n){if(13==n.keyCode){var a=o.val();n.preventDefault(),t(a)}}),function(){var n=void 0,a=[];$.get("//owf5g9dnv.bkt.clouddn.com/songsDB.json?v=20170922",function(e){for(n=e;a.length<6;){var i=Math.floor(10*Math.random());-1===a.indexOf(i)&&a.push(i)}var s=$("<ul></ul>");a.map(function(a){n.map(function(n){if(n.id===a){var e=$('\n                <li class="item"><a href="./play.html?id='+n.id+'">'+n.songName+"</a></li>               \n                ");s.append(e)}})}),s.on("click","li",function(n){var a=$(n.currentTarget).text().trim();t(a)}),l.append(s)})}(),t(),e.attr("data-isLoaded","yes")}})});